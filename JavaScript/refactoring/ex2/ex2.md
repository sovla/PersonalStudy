# 리팩터링 원칙
## 리팩터링 정의
리팩터링 : 소프트웨어의 겉보기 동작은 그대로 유지한 채, 코드를 이해하고 수정하기 쉽도록 내부 구조를 변경하는 기법

"누군가 리팩토링을 하다가 코드가 깨져서 며칠이나 고생했다고 하면 십중팔구 리팩토링한 것이 아니다."

## 기능 추가와 리팩토링 두 모자
기능 추가시 기존 코드는 절대 건들지 않고 새 기능을 추가만 해야 한다.
리팩터링시 절대 기능 추가는 없으며 기존 코드만 건드는 방향으로 진행한다.

## 리팩터링 장점
- 리팩터링하면 소프트웨어 설계가 좋아진다
- 리팩터링하면 소프트웨어를 이해하기 쉬워진다
- 리팩터링하면 버그를 쉽게 찾을 수 있다.
- 리팩터링하면 프로그래밍 속도를 높일 수 있다.


## 언제 리팩터링해야 할까?

3의 법칙
1. 처음에는 그냥 한다
2. 비슷한 일을 두 번째로 하게 되면, 일단 계속 진행한다.
3. 비슷한 일을 세 번째 하게 되면 리팩터링한다.

### 준비를 위한 리팩터링: 기능을 쉽게 추가하게 만들기
리팩터링 하기 가장 좋은 시점은 코드베이스에 기능을 새로 추가하기 직전!

### 이해를 위한 리팩터링: 코드를 이해하기 쉽게 만들기
1. 코드가 하는 일 이해하기.
2. 의도가 더 명확하게 드러나도록 리팩토링 할 여지가 없는지 확인하기(조건부 로직, 변수명)

### 쓰레기 줍기 리팩터링
코드 파악중 비효율적 처리 방식을 보게 되면, 간단히 수정할 수 있는 것은 즉시 고치고, 시간이 걸릴 일들은 짧은 메모를 남긴 다음 하던 일을 끝내고 나서 처리한다.

### 계획된 리팩토링과 수시로 하는 리팩토링
앞에서 본 준비,이해,쓰레기 줍기 리팩토링은 모두 기회가 될때만 진행한다. 
기능추가, 버그수정 중 리팩토링도 함께 진행한다. 별도의 시간을 내서 하는 행위가 아닌 if else 처럼 자연스럽게 리팩토링 할 수 있도록 하자.

오랫동안 소프트웨어 개발을 뭔가 추가하는 과정으로 여겼다. 뛰어난 개발자는 단순 추가가 아닌 새 기능을 추가하기 쉽도록 코드를 수정하는 것이 그 기능을 가장 빠르게 추가할 수 있는 길임을 알고 있다.

### 오래걸리는 리팩토링


### 데이터 베이스 리팩토링 과정
데이터 베이스 리팩토링 과정은 어렵게 느껴지지만 비교적 간단하게 진행 된다.
```dart
Class ModelUser{
    int age;
    String name;
    List<ModelAnimal> animals; // 키우고 있는 반려견
    ModelUser.toJson(Json json){
        age = json["age"];
        name = json["name"];
        animals = json["animals"];
        // 이곳에 변환 스크립트를 통해 관리 만약 동물이 제거 되었거나 수정이 있을경우
        // 버전별 마이그레이션 스크립트를 통해 관리하는것이 중요
        if(version == "1.0.0"){
            animals = json["animals_name"]; // 동물 이름만 받아오도록 변경 
        }else if(version == "1.5.0"){
            animals = []; // 동물 데이터 제거
        }

    }   
}

Class ModelAnimal{
    String name;
    AnimalType type; // 강아지 고양이 분류
}

```

데이터 베이스 리팩토링은 프로덕션 환경에 여러 단계로 나눠서 릴리스하는 것이 좋다.
필드 이름을 바꾸는 과정 (병렬 추가 -> 부분 수정 -> 검토 -> 최종 변경)
- 첫 번째 커밋에서는 새로운 데이터베이스 필드를 추가만 하고 사용하지 않는다
- 기존 필드와 새 필드를 동시에 업데이트하도록 설정한다
- 데이터베이스를 읽는 클라이언트들을 새 필드를 사용하는 버전으로 조금씩 교체한다
- 앞선 과정에서 발생한 버그도 해결하면 클라이언트 교체 작업이 끝났기에 이전 필드를 제거한다.
